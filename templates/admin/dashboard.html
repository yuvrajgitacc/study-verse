{% extends "admin/base.html" %}
{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<style>
    /* ‚îÄ‚îÄ‚îÄ Dashboard-specific extras ‚îÄ‚îÄ‚îÄ */
    .dash-welcome {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 28px;
        padding: 24px 28px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-xl);
        position: relative;
        overflow: hidden;
    }

    .dash-welcome::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg,
                rgba(74, 222, 128, 0.05) 0%,
                rgba(59, 130, 246, 0.03) 50%,
                transparent 100%);
        pointer-events: none;
    }

    .dash-welcome::after {
        content: '';
        position: absolute;
        top: -80px;
        right: -80px;
        width: 240px;
        height: 240px;
        background: radial-gradient(circle, rgba(74, 222, 128, 0.08) 0%, transparent 65%);
        pointer-events: none;
    }

    .dash-welcome-left h2 {
        font-size: 22px;
        font-weight: 800;
        color: var(--text-primary);
        letter-spacing: -0.4px;
        margin-bottom: 6px;
    }

    .dash-welcome-left p {
        font-size: 13.5px;
        color: var(--text-muted);
    }

    .dash-welcome-right {
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
        z-index: 1;
    }

    .welcome-stat-pill {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 12px 20px;
        background: var(--bg-card-2);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        min-width: 80px;
        transition: var(--transition);
    }

    .welcome-stat-pill:hover {
        border-color: var(--border-glow);
        transform: translateY(-2px);
    }

    .welcome-stat-pill .val {
        font-size: 22px;
        font-weight: 800;
        color: var(--text-primary);
        letter-spacing: -0.5px;
        line-height: 1;
    }

    .welcome-stat-pill .lbl {
        font-size: 11px;
        color: var(--text-muted);
        margin-top: 4px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    /* Stat cards row */
    .stat-cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
        margin-bottom: 28px;
    }

    .stat-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 22px;
        position: relative;
        overflow: hidden;
        transition: var(--transition);
        cursor: default;
    }

    .stat-card::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 80px;
        height: 80px;
        border-radius: 50%;
        transform: translate(30px, -30px);
        opacity: 0.06;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
    }

    .stat-card-icon {
        width: 46px;
        height: 46px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 16px;
        font-size: 20px;
    }

    .stat-card-value {
        font-size: 34px;
        font-weight: 800;
        color: var(--text-primary);
        letter-spacing: -1px;
        line-height: 1;
        margin-bottom: 5px;
    }

    .stat-card-label {
        font-size: 12px;
        color: var(--text-muted);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.6px;
    }

    /* Colour sets */
    .sc-green {
        border-color: rgba(74, 222, 128, 0.15);
    }

    .sc-green .stat-card-icon {
        background: rgba(74, 222, 128, 0.1);
        color: #4ade80;
    }

    .sc-green::after {
        background: #4ade80;
    }

    .sc-green:hover {
        border-color: rgba(74, 222, 128, 0.35);
    }

    .sc-blue {
        border-color: rgba(59, 130, 246, 0.15);
    }

    .sc-blue .stat-card-icon {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
    }

    .sc-blue::after {
        background: #3b82f6;
    }

    .sc-blue:hover {
        border-color: rgba(59, 130, 246, 0.35);
    }

    .sc-purple {
        border-color: rgba(139, 92, 246, 0.15);
    }

    .sc-purple .stat-card-icon {
        background: rgba(139, 92, 246, 0.1);
        color: #8b5cf6;
    }

    .sc-purple::after {
        background: #8b5cf6;
    }

    .sc-purple:hover {
        border-color: rgba(139, 92, 246, 0.35);
    }

    .sc-orange {
        border-color: rgba(245, 158, 11, 0.15);
    }

    .sc-orange .stat-card-icon {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
    }

    .sc-orange::after {
        background: #f59e0b;
    }

    .sc-orange:hover {
        border-color: rgba(245, 158, 11, 0.35);
    }

    /* Content grid */
    .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 24px;
    }

    .card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        overflow: hidden;
    }

    .card-header {
        padding: 18px 22px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.015);
    }

    .card-title {
        font-size: 15px;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .card-title i {
        color: var(--accent);
        font-size: 14px;
    }

    .view-all-link {
        color: var(--accent);
        text-decoration: none;
        font-size: 12.5px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
        transition: var(--transition);
        opacity: 0.8;
    }

    .view-all-link:hover {
        opacity: 1;
        transform: translateX(2px);
    }

    .card-body {
        padding: 16px 20px 20px;
    }

    /* User row items */
    .user-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 14px;
        background: var(--bg-card-2);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        margin-bottom: 8px;
        transition: var(--transition);
        text-decoration: none;
        color: inherit;
    }

    .user-item:last-child {
        margin-bottom: 0;
    }

    .user-item:hover {
        background: rgba(74, 222, 128, 0.04);
        border-color: rgba(74, 222, 128, 0.2);
        transform: translateX(3px);
    }

    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #000;
        font-weight: 700;
        font-size: 14px;
        flex-shrink: 0;
    }

    .user-info {
        flex: 1;
        min-width: 0;
    }

    .user-name {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .user-email {
        font-size: 12px;
        color: var(--text-muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .user-meta {
        text-align: right;
        flex-shrink: 0;
    }

    .user-date {
        font-size: 11px;
        color: var(--text-muted);
        margin-bottom: 5px;
    }

    .level-badge {
        background: rgba(74, 222, 128, 0.1);
        color: #4ade80;
        border: 1px solid rgba(74, 222, 128, 0.2);
        font-size: 11px;
        padding: 3px 10px;
        border-radius: 20px;
        font-weight: 700;
    }

    /* Quick action buttons */
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }

    .quick-action-btn {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 14px 16px;
        background: var(--bg-card-2);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 13.5px;
        font-weight: 600;
        transition: var(--transition);
        cursor: pointer;
    }

    .quick-action-btn:hover {
        border-color: var(--border-glow);
        color: var(--accent);
        background: rgba(74, 222, 128, 0.04);
        transform: translateY(-2px);
    }

    .quick-action-btn i {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: var(--bg-card);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        flex-shrink: 0;
        transition: var(--transition);
    }

    .quick-action-btn:hover i {
        background: rgba(74, 222, 128, 0.1);
        color: var(--accent);
    }

    /* System health row */
    .health-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
    }

    .health-card {
        background: var(--bg-card-2);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: 16px;
        text-align: center;
        transition: var(--transition);
    }

    .health-card:hover {
        border-color: var(--border-glow);
    }

    .health-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 10px;
        font-size: 16px;
    }

    .health-label {
        font-size: 11px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .health-value {
        font-size: 15px;
        font-weight: 700;
        color: var(--text-primary);
    }
</style>

<!-- ‚îÄ‚îÄ Welcome Banner ‚îÄ‚îÄ -->
<div class="dash-welcome">
    <div class="dash-welcome-left" style="position: relative; z-index: 1;">
        <h2>Welcome back, {{ current_user.first_name }} üëã</h2>
        <p>Here's an overview of your StudyVerse platform at a glance.</p>
    </div>
    <div class="dash-welcome-right">
        <div class="welcome-stat-pill">
            <span class="val" style="color: #4ade80;">{{ stats.total_users }}</span>
            <span class="lbl">Total Users</span>
        </div>
        <div class="welcome-stat-pill">
            <span class="val" style="color: #3b82f6;">{{ stats.active_users }}</span>
            <span class="lbl">Active</span>
        </div>
        {% if stats.open_tickets is defined %}
        <div class="welcome-stat-pill">
            <span class="val" style="color: #f59e0b;">{{ stats.open_tickets|default(0) }}</span>
            <span class="lbl">Tickets</span>
        </div>
        {% endif %}
    </div>
</div>

<!-- ‚îÄ‚îÄ Stat Cards Row ‚îÄ‚îÄ -->
<div class="stat-cards">
    <div class="stat-card sc-green">
        <div class="stat-card-icon"><i class="fa-solid fa-users"></i></div>
        <div class="stat-card-value">{{ stats.total_users }}</div>
        <div class="stat-card-label">Total Users</div>
    </div>

    <div class="stat-card sc-blue">
        <div class="stat-card-icon"><i class="fa-solid fa-user-check"></i></div>
        <div class="stat-card-value">{{ stats.active_users }}</div>
        <div class="stat-card-label">Active Users</div>
    </div>

    <div class="stat-card sc-purple">
        <div class="stat-card-icon"><i class="fa-solid fa-trophy"></i></div>
        <div class="stat-card-value">{{ stats.xp_awarded|default('‚Äî') }}</div>
        <div class="stat-card-label">XP Awarded</div>
    </div>

    <div class="stat-card sc-orange">
        <div class="stat-card-icon"><i class="fa-solid fa-headset"></i></div>
        <div class="stat-card-value">{{ stats.open_tickets|default(0) }}</div>
        <div class="stat-card-label">Open Tickets</div>
    </div>
</div>

<!-- ‚îÄ‚îÄ Main content grid ‚îÄ‚îÄ -->
<div class="content-grid">

    <!-- Recent Users -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">
                <i class="fa-solid fa-user-clock"></i> Recent Users
            </div>
            <a href="{{ url_for('admin_users') }}" class="view-all-link">
                View All <i class="fa-solid fa-arrow-right fa-xs"></i>
            </a>
        </div>
        <div class="card-body">
            {% for user in recent_users %}
            <a class="user-item" href="{{ url_for('admin_user_detail', user_id=user.id) }}">
                <div class="user-avatar" style="background: linear-gradient(135deg,
                        {{ ['#4ade80','#3b82f6','#8b5cf6','#f59e0b','#ec4899'][loop.index0 % 5] }} 0%,
                        {{ ['#22c55e','#2563eb','#7c3aed','#d97706','#db2777'][loop.index0 % 5] }} 100%);">
                    {{ user.first_name[0] }}{{ user.last_name[0] }}
                </div>
                <div class="user-info">
                    <div class="user-name">{{ user.first_name }} {{ user.last_name }}</div>
                    <div class="user-email">{{ user.email }}</div>
                </div>
                <div class="user-meta">
                    <div class="user-date">{{ user.created_at.strftime('%b %d') }}</div>
                    <span class="level-badge">Lv {{ user.level }}</span>
                </div>
            </a>
            {% else %}
            <div style="text-align:center; padding: 40px 0; color: var(--text-muted);">
                <i class="fa-solid fa-users" style="font-size:28px; opacity:.3; display:block; margin-bottom:10px;"></i>
                No users yet
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Quick Actions + System Health -->
    <div style="display: flex; flex-direction: column; gap: 20px;">

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fa-solid fa-bolt"></i> Quick Actions
                </div>
            </div>
            <div class="card-body">
                <div class="quick-actions">
                    <a href="{{ url_for('admin_users') }}" class="quick-action-btn">
                        <i class="fa-solid fa-users"></i> Manage Users
                    </a>
                    <a href="{{ url_for('admin_gamification') }}" class="quick-action-btn">
                        <i class="fa-solid fa-trophy"></i> Gamification
                    </a>
                    <a href="{{ url_for('admin_support') }}" class="quick-action-btn">
                        <i class="fa-solid fa-headset"></i> Support Tickets
                    </a>
                    <a href="{{ url_for('admin_analytics') }}" class="quick-action-btn">
                        <i class="fa-solid fa-chart-line"></i> Analytics
                    </a>
                    <a href="{{ url_for('admin_shop') }}" class="quick-action-btn">
                        <i class="fa-solid fa-cart-shopping"></i> Shop Items
                    </a>
                    <a href="{{ url_for('admin_battles') }}" class="quick-action-btn">
                        <i class="fa-solid fa-fire-flame-curved"></i> Study
                    </a>
                </div>
            </div>
        </div>

        <!-- System Health -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fa-solid fa-server"></i> System Health
                </div>
                <span style="font-size:11px; background: rgba(74,222,128,0.1); color: #4ade80;
                             border: 1px solid rgba(74,222,128,0.2); padding: 3px 10px;
                             border-radius: 20px; font-weight: 700;">‚óè All Systems Live</span>
            </div>
            <div class="card-body">
                <div class="health-grid">
                    <div class="health-card">
                        <div class="health-icon" style="background: rgba(74,222,128,0.1);">
                            <i class="fa-solid fa-database" style="color: #4ade80;"></i>
                        </div>
                        <div class="health-label">Database</div>
                        <div class="health-value" style="color: #4ade80;">Online</div>
                    </div>
                    <div class="health-card">
                        <div class="health-icon" style="background: rgba(59,130,246,0.1);">
                            <i class="fa-solid fa-plug" style="color: #3b82f6;"></i>
                        </div>
                        <div class="health-label">Socket.IO</div>
                        <div class="health-value" style="color: #3b82f6;">Active</div>
                    </div>
                    <div class="health-card">
                        <div class="health-icon" style="background: rgba(139,92,246,0.1);">
                            <i class="fa-solid fa-robot" style="color: #8b5cf6;"></i>
                        </div>
                        <div class="health-label">AI Coach</div>
                        <div class="health-value" style="color: #8b5cf6;">Ready</div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}
